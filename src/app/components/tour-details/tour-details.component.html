<div class="min-h-screen bg-gradient-to-br from-stone-50 via-forest-50/20 to-mountain-50/20">
  
  <!-- Hero Section with Tour Image -->
  <div *ngIf="tour" class="relative h-96 sm:h-[500px] lg:h-[600px] overflow-hidden">
    <img [src]="tour.photo" [alt]="tour.name"
         class="w-full h-full object-cover">
    
    <!-- Gradient Overlay -->
    <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/30 to-transparent"></div>
    
    <!-- Hero Content -->
    <div class="absolute inset-0 flex items-end">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-16 w-full">
        <div class="text-white">
          <!-- Breadcrumb -->
          <nav class="mb-4">
            <ol class="flex items-center space-x-2 text-sm">
              <li><a routerLink="/" class="hover:text-sunset-300 transition-colors duration-200">Home</a></li>
              <li class="text-white/60">/</li>
              <li><a routerLink="/" class="hover:text-sunset-300 transition-colors duration-200">Tours</a></li>
              <li class="text-white/60">/</li>
              <li class="text-white/80">{{ tour.name }}</li>
            </ol>
          </nav>
          
          <!-- Tour Title and Basic Info -->
          <div class="flex flex-col lg:flex-row lg:items-end lg:justify-between">
            <div class="flex-1">
              <h1 class="text-4xl sm:text-5xl lg:text-6xl font-heading font-bold text-shadow mb-4">
                {{ tour.name }}
              </h1>
              
              <!-- Club Info -->
              <div *ngIf="tour.clubName && tour.clubPhoto" class="flex items-center space-x-3 mb-6">
                <img [src]="tour.clubPhoto" [alt]="tour.clubName"
                     class="w-12 h-12 rounded-full border-2 border-white/30">
                <div>
                  <p class="text-white/80 text-sm">Organized by</p>
                  <p class="text-white font-semibold text-lg">{{ tour.clubName }}</p>
                </div>
              </div>
              
              <!-- Key Stats -->
              <div class="flex flex-wrap items-center gap-4">
                <div class="flex items-center space-x-2 bg-white/20 backdrop-blur-subtle px-4 py-2 rounded-xl">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                  </svg>
                  <span class="font-medium">{{ tour.date | date:'mediumDate' }}</span>
                </div>
                
                <div class="flex items-center space-x-2 bg-white/20 backdrop-blur-subtle px-4 py-2 rounded-xl">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                  </svg>
                  <span class="font-medium">{{ tour.maxParticipants - tour.participantsIds.length }} spots left</span>
                </div>
                
                <div [ngClass]="{
                  'bg-forest-500/80': tour.difficulty === 'easy',
                  'bg-sunset-500/80': tour.difficulty === 'moderate',
                  'bg-red-500/80': tour.difficulty === 'hard'
                }" class="flex items-center space-x-2 backdrop-blur-subtle px-4 py-2 rounded-xl">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M13 10V3L4 14h7v7l9-11h-7z"/>
                  </svg>
                  <span class="font-medium capitalize">{{ tour.difficulty }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <div class="flex flex-col lg:flex-row gap-8">
      
      <!-- Left Column: Tour Details -->
      <div class="flex-1 space-y-8">
        
        <!-- Tour Description -->
        <div class="card-nature p-8">
          <h2 class="text-2xl font-heading font-bold text-stone-900 mb-6 flex items-center">
            <svg class="w-6 h-6 text-forest-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
            </svg>
            About This Adventure
          </h2>
          <p class="text-stone-700 text-lg leading-relaxed">{{ tour.description }}</p>
        </div>

        <!-- Interactive Map -->
        <div class="card-nature p-6">
          <h2 class="text-2xl font-heading font-bold text-stone-900 mb-6 flex items-center">
            <svg class="w-6 h-6 text-mountain-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/>
            </svg>
            Trail Route
          </h2>
          <div class="bg-stone-100 rounded-xl overflow-hidden">
            <app-map [gpxContent]="tour.gpxContent" class="w-full h-64 sm:h-80"></app-map>
          </div>
        </div>

        <!-- Reviews Section -->
        <div class="card-nature p-8">
          <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-heading font-bold text-stone-900 flex items-center">
              <svg class="w-6 h-6 text-sunset-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
              </svg>
              Participant Reviews
            </h2>
            
            <!-- Average Rating -->
            <div *ngIf="averageRating > 0" class="text-right">
              <div class="flex items-center justify-end space-x-2">
                <div class="flex">
                  <svg *ngFor="let i of [1,2,3,4,5]"
                       [class]="i <= averageRating ? 'text-sunset-400' : 'text-stone-300'"
                       class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                  </svg>
                </div>
                <span class="text-lg font-semibold text-stone-900">{{ averageRating | number:'1.1-1' }}</span>
                <span class="text-stone-600">({{ reviews.length }} {{ reviews.length === 1 ? 'review' : 'reviews' }})</span>
              </div>
            </div>
          </div>
          
          <!-- Reviews List -->
          <div *ngIf="reviews && reviews.length > 0; else noReviews" class="space-y-6">
            <div *ngFor="let review of reviews"
                 class="border border-stone-200 rounded-xl p-6 bg-stone-50/50 hover:bg-stone-50 transition-colors duration-200">
              <div class="flex items-start space-x-4">
                <img [src]="review.userPhoto || 'assets/profile-photo1.jpg'"
                     [alt]="review.userName + ' photo'"
                     class="w-12 h-12 rounded-full object-cover border-2 border-white shadow-sm">
                <div class="flex-1">
                  <div class="flex items-center justify-between mb-2">
                    <h4 class="font-semibold text-stone-900">{{ review.userName }}</h4>
                    <time class="text-sm text-stone-500">{{ review.timestamp | date:'mediumDate' }}</time>
                  </div>
                  
                  <!-- Star Rating -->
                  <div class="flex items-center space-x-2 mb-3">
                    <div class="flex">
                      <svg *ngFor="let i of [1,2,3,4,5]"
                           [class]="i <= review.rating ? 'text-sunset-400' : 'text-stone-300'"
                           class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                      </svg>
                    </div>
                    <span class="text-sm text-stone-600">({{ review.rating }}/5)</span>
                  </div>
                  
                  <p class="text-stone-700 leading-relaxed">{{ review.review }}</p>
                </div>
              </div>
            </div>
          </div>
          
          <ng-template #noReviews>
            <div class="text-center py-12">
              <div class="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-sunset-100 to-forest-100 rounded-full flex items-center justify-center">
                <svg class="w-8 h-8 text-sunset-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                </svg>
              </div>
              <h3 class="text-lg font-medium text-stone-900 mb-2">No Reviews Yet</h3>
              <p class="text-stone-600">Be the first to share your experience!</p>
            </div>
          </ng-template>
        </div>
      </div>

      <!-- Right Column: Sidebar -->
      <div class="lg:w-80 space-y-6">
        
        <!-- Application Actions -->
        <div class="card-nature p-6 sticky top-6">
          <h3 class="text-lg font-heading font-bold text-stone-900 mb-4">Join This Adventure</h3>
          
          <!-- Apply Button -->
          <button *ngIf="isHiker && !hasApplied"
                  [disabled]="tour.maxParticipants - tour.participantsIds.length === 0"
                  (click)="applyForTour()"
                  class="btn-nature w-full mb-4 disabled:opacity-50 disabled:cursor-not-allowed">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
            </svg>
            {{ tour.maxParticipants - tour.participantsIds.length === 0 ? 'Tour Full' : 'Apply for Tour' }}
          </button>
          
          <!-- Cancel Application Button -->
          <button *ngIf="isHiker && hasApplied && application && (application.status === 'pending' || application.status === 'accepted')"
                  (click)="cancelMyApplication()"
                  class="btn-outline-nature w-full mb-4 border-red-300 text-red-600 hover:bg-red-50">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
            Cancel Application
          </button>
          
          <!-- Application Status -->
          <div *ngIf="application" class="mb-4 p-4 rounded-xl border-2"
               [ngClass]="{
                 'bg-forest-50 border-forest-200': application.status === 'accepted',
                 'bg-sunset-50 border-sunset-200': application.status === 'pending',
                 'bg-red-50 border-red-200': application.status === 'declined'
               }">
            <h4 class="font-semibold mb-2"
                [ngClass]="{
                  'text-forest-800': application.status === 'accepted',
                  'text-sunset-800': application.status === 'pending',
                  'text-red-800': application.status === 'declined'
                }">
              Application Status
            </h4>
            <p class="text-sm mb-1">
              <strong>Status:</strong>
              <span class="capitalize">{{ application.status }}</span>
            </p>
            <p *ngIf="application.declinedMessage" class="text-sm">
              <strong>Message:</strong> {{ application.declinedMessage }}
            </p>
          </div>
          
          <!-- Tour Stats -->
          <div class="space-y-3 pt-4 border-t border-stone-200">
            <div class="flex items-center justify-between text-sm">
              <span class="text-stone-600">Max Participants</span>
              <span class="font-semibold text-stone-900">{{ tour.maxParticipants }}</span>
            </div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-stone-600">Spots Available</span>
              <span class="font-semibold"
                    [class]="tour.maxParticipants - tour.participantsIds.length > 0 ? 'text-forest-600' : 'text-red-600'">
                {{ tour.maxParticipants - tour.participantsIds.length }}
              </span>
            </div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-stone-600">Difficulty</span>
              <span class="font-semibold capitalize"
                    [ngClass]="{
                      'text-forest-600': tour.difficulty === 'easy',
                      'text-sunset-600': tour.difficulty === 'moderate',
                      'text-red-600': tour.difficulty === 'hard'
                    }">
                {{ tour.difficulty }}
              </span>
            </div>
          </div>
        </div>

        <!-- Participants List -->
        <div *ngIf="tour.participantsNames.length > 0" class="card-nature p-6">
          <h3 class="text-lg font-heading font-bold text-stone-900 mb-4 flex items-center">
            <svg class="w-5 h-5 text-mountain-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
            </svg>
            Participants ({{ tour.participantsNames.length }})
          </h3>
          <div class="space-y-3 max-h-64 overflow-y-auto">
            <div *ngFor="let participant of tour.participantsNames; let i = index"
                 class="flex items-center space-x-3 p-3 bg-stone-50 rounded-lg hover:bg-stone-100 transition-colors duration-200">
              <img [src]="tour.participantsPhotos[i]" [alt]="participant"
                   class="w-10 h-10 rounded-full object-cover border-2 border-white shadow-sm">
              <span class="font-medium text-stone-900">{{ participant }}</span>
            </div>
          </div>
        </div>

        <!-- Share Section -->
        <div class="card-nature p-6">
          <h3 class="text-lg font-heading font-bold text-stone-900 mb-4">Share This Adventure</h3>
          <div class="flex space-x-3">
            <button (click)="shareButtonClicked()" class="flex-1 btn-outline-nature text-sm py-2 px-3">
              <svg *ngIf="!isSharing" class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"/>
              </svg>
              <svg *ngIf="isSharing" class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
              </svg>
              {{ isSharing ? 'Copied!' : 'Share' }}
            </button>
            <button class="flex-1 btn-outline-nature text-sm py-2 px-3">
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
              </svg>
              Save
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>